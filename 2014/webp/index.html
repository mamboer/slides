<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8"/>

		<title>FASO - Can i use webp?</title>

		<meta name="description" content="Webp - The new image format recommended by Google,can i use it?"/>
		<meta name="author" content="FASO.ME"/>

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>

		<link rel="stylesheet" href="../../assets/common/css/font-Limelight.css"/>
        <link rel="stylesheet" href="../../assets/revealjs/css/reveal.min.css"/>
		<link rel="stylesheet" href="../../assets/revealjs/css/theme/night.css" id="theme"/>
        <link rel="stylesheet" href="../../assets/common/css/table.css"/>
        <style>
            .reveal {font-family:"Georgia", "Xin Gothic", "Hiragino Sans GB", "Droid Sans Fallback", "Microsoft YaHei", sans-serif;}
            .reveal h1, .reveal h2, .reveal h3, .reveal h4, .reveal h5, .reveal h6{font-family:'Limelight';}
            .reveal h1{margin-bottom:25px;}
            .red{background:rgb(223, 117, 20) !important;color:#fff !important;}
            .green{background:rgb(28, 184, 65) !important;color:#fff !important;}
            .reveal .hl {color:#e7ad52;font-size:105%;font-style:normal;font-weight:500;}
        </style>
		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="../../assets/revealjs/lib/css/zenburn.css"/>

		<!-- If the query includes 'print-pdf', include the PDF print sheet -->
		<script>
			if( window.location.search.match( /print-pdf/gi ) ) {
				var link = document.createElement( 'link' );
				link.rel = 'stylesheet';
				link.type = 'text/css';
				link.href = '../../assets/revealjs/css/print/pdf.css';
				document.getElementsByTagName( 'head' )[0].appendChild( link );
			}
		</script>

		<!--[if lt IE 9]>
		<script src="../../assets/revealjs/lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
                <section>
					<h1>WebP</h1>
				</section>

                <section>
                    <h1>About Me</h1>
                    <ol>
                        <li class="fragment"><p>老黄、LV、驴哥、小悠</p></li>
                        <li class="fragment"><p>码农（<em class="hl hl-02">8</em>年。Html、Css、Js、NodeJs、C#、Java、Swift...）</p></li>
                        <li class="fragment"><p>搜狐MDC、百度知道、腾讯ISUX、腾讯ECD</p>
                        <li class="fragment"><p>@腾讯互娱/TGIdeas创意设计中心</p></li>
                        <li class="fragment"><p><a href="http://faso.me" target="_blank">faso.me</a> &amp; <a href="http://github.com/mamboer" target="_blank">github.com/mamboer</a></p></li>
                    </ol>
                </section>

                <section>
                    <h1>Agenda</h1>
                    <ol>
                        <li><p><a href="#/3">是什么?</a></p></li>
                        <li><p><a href="#/4">谁在用?</a></p></li>
                        <li><p><a href="#/5">兼容性?</a></p></li>
                        <li><p><a href="#/6">用还是不用?</a></p></li>
                        <li><p><a href="#/7">怎么用?</a></p></li>
                        <li><p><a href="#/12">性能?</a></p></li>
                        <li><p><a href="#/13">工具推荐</a></p></li>
                    </ol>
                </section>

				<section id="what">
                    <section>
                        <h2>是什么?</h2>
                    </section>
                    <section>
                        <h3>一种新的图片格式</h3>
                    </section>
                    <section>
                        <h3>2011年 Google</h3>
                    </section>
                    <section>
                        <h3>无损压缩（同质PNG，尺寸小25%）</h3>
                    </section>
                    <section>
                        <h3>有损压缩（同质JPG，尺寸小25~34%）</h3>
                    </section>
                    <section>
                        <h3>更吊的图像编码技术</h3>
                        <ul>
                            <li>Fancy采样算法</li>
                            <li>区域智能压缩</li>
                            <li>预测编码技术</li>
                        </ul>
                        <aside class="notes">
                            <ol>
                                <li>可有效降低图片内色彩边缘的像素</li>
                                <li>同一张图片里的不同区域进行不同形式的压缩，在图片质量和图片大小上实现最佳平衡</li>
                                <li>通过部分像素块的颜色来预测其邻近块的颜色值，并只记录两者的差值，提高压缩比</li>
                            </ol>  
                        </aside>
                    </section>
				</section>

				<!-- Example of nested vertical slides -->
				<section id="whoAndWhere">
					<section>
                        <h2>谁在用?</h2>
					</section>
					<section>
						<h2>Chrome Webstore</h2>
                        <p>
                            全站应用webp
                        </p>
                        <img src="img/webstore.png" alt="webstore"/>
					</section>
					<section>
						<h2>QZone</h2>
						<p>部分应用：大背景、动态里面的照片</p>
                        <img src="img/qzone.png" alt="qzone"/>
					</section>
					<section>
						<h2>淘宝&amp;天猫</h2>
						<p>部分应用：列表页</p>
                        <a href="http://www.taobao.com/market/nvzhuang/xinpin-kaishan.php?spm=a217f.1217951.1998072001.1.HrZH9n" target="_blank"><img src="img/taobao.png" alt="taobao"/></a>
					</section>
				</section>

				<section id="compatibility">
					<section>
                        <h2>兼容性?</h2>
                    </section>
                    <section>
                        <iframe src="caniuse.html" scrolling="no" seamless="seamless" style="min-height:520px;width:100%;"></iframe>
                    </section>
                    <section>
                        <h3>各主流浏览器实际支持情况</h3>
                        <div class="datagrid">
                            <table>
                                <thead>
                                    <tr>
                                        <th>OS\BROWSER</th>
                                        <th>UC浏览器(9.0+)</th>
                                        <th>QQ浏览器(5.0+)</th>
                                        <th>Chrome浏览器(36.0+)</th>
                                        <th>Android内置浏览器(4.0+)</th>
                                        <th>微信内置webview</th>
                                        <th>QQ内置webview</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>IOS</strong></td>
                                        <td class="red">否</td>
                                        <td class="red">否</td>
                                        <td class="green">是</td>
                                        <td>N/A</td>
                                        <td class="red">否</td>
                                        <td class="red">否</td>
                                    </tr>
                                    <tr class="alt">
                                        <td><strong>Android</strong></td>
                                        <td class="green">是</td>
                                        <td class="green">是</td>
                                        <td class="green">是</td>
                                        <td class="green">是</td>
                                        <td class="red">否</td>
                                        <td class="red">否</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </section>
                    <section>
                        <h3>兼容性结论</h3>
                        <p>从设备\操作系统\浏览器的角度看，兼容性达<em class="hl">50%</em></p>
                    </section>
				</section>


				<section id="how">
                    <section>
                        <h3>那么问题来了?</h3>
                        <h2>到底用还是不用呢</h2>
                    </section>
                    <section>
                        <h3>这是一个没有标准答案的问题</h3>
                        <p class="fragment">但，有一些数据和建议可以参考</p>
                    </section>
                    <section>
                        <h3>国内桌面浏览器上一季度市场份额</h3>
                        <p>Chrome浏览器49%+，对webp兼容良好</p>
                        <img src="img/StatCounter-browser-CN-monthly-201407-201409-bar1.jpg" alt="桌面浏览器市场份额201407-09"/>
                    </section>
                    <section>
                        <h3>国内移动端浏览器上一季度市场份额</h3>
                        <p>UC浏览器+Chrome浏览器市场份额接近70%，对webp兼容良好</p>
                        <img src="img/StatCounter-browser-CN-monthly-201407-201409-bar.jpg" alt="移动端浏览器市场份额201407-09"/>
                    </section>
                    <section>
                        <h3>天天飞车官网上个月 - 操作系统市场份额</h3>
                        <p>Android系统的访问量超过<em class="hl">70%</em></p>
                        <img src="img/ttfc-os-chart.png" alt="天天飞车操作系统市场份额201410"/>
                    </section>
                    <section>
                        <h2>说明什么问题？</h2>
                        <ol>
                            <li class="fragment">
                                <p>如果用webp，大约<em class="hl">50%</em>用户受益，当然另外<em class="hl">50%</em>用户需要兼顾处理</p>
                            </li>
                            <li class="fragment">
                                如果图片大小占据页面大小一半或以上，<em class="hl">【建议用！】</em>
                            </li>
                            <li class="fragment">客户端软件，内嵌了基于Chromium的webview，<em class="hl">【必须用！】</em></li>
                            <li class="fragment">客户端软件，如果使用node-webkit开发，<em class="hl">【必须用！】</em></li>
                        </ol>
                    </section>
				</section>

				<section>
                    <section>
					    <h3>那么问题又来了?</h3>
                        <h2>如何兼顾不支持webp的浏览器?</h2>
                    </section>
                    <section>
                        <h3>按需加载，优雅降级</h3>
                        <pre>
                        <code data-trim>
                            <img 
                                data-src="1.png" 
                                data-webp="1.png.webp" 
                                src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"/>
                        </code>
                        </pre>
                        <ol>
                            <li>img标签使用1px的透明gif做填充图片</li>
                            <li>利用data-src放普通图片</li>
                            <li>利用data-webp放webp图片</li>
                            <li>利用js判断浏览器是否支持webp，从而选择合适的图片格式</li>
                        </ol>
                    </section>
                    <section>
                        <h3>如何判断浏览器是否支持webp？</h3>
                        <pre>
                            <code data-trim>
    var img = new Image();
    img.src = "data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA";
    img.onload = img.onerror = function() {
      if(img.width === 2 && img.height === 2){
          //支持webp    
      }else{
          //不支持webp
      };
    };
                           </code>
                        </pre>
                    </section>
                    <section>
                        <h3>按需加载的优缺点</h3>
                        <ul>
                            <li>优点：特别适用于内容图较多较大的页面，可以让大约<em class="hl">50%</em>的用户显著提升图片加载速度，较少流量消耗</li>
                            <li>缺点：需要为按需加载的图片准备一套webp格式的</li>
                        </ul>
                    </section>
				</section>

				<section>
					<section>
                    <h2>银弹？</h2>
                    <aside class="notes">
                        有没有可能让所有的浏览器兼容webp格式呢
                    </aside>
                    </section>
				    <section>
				        <img src="img/webpjs-qrcode.png" alt="qrcode"/>
                    </section>
				</section>

				<section>
				    <section>
                        <h2>
                            WebPJS
                        </h2>
                        <p>借助FLASH兼容不支持webp的浏览器</p>
                    </section>
                    <section>
                        <h3>下载所需文件-webpjs.appspot.com</h3>
                        <ol>
                            <li><a href="http://webpjs.appspot.com/js/webpjs-0.0.2.min.js" target="_blank">webpjs-0.0.2.min.js</a></li>
                            <li><a href="http://webpjs.appspot.com/js/webpjs-0.0.2.swf" target="_blank">webpjs-0.0.2.swf</a></li>
                        </ol>
                    </section>
                    <section>
                        <h3>在页头引入JS</h3>
                        <pre>
                            <code data-trim>
                            <script>(function(){var WebP=new Image();WebP.onload=WebP.onerror=function(){
if(WebP.height!=2){var sc=document.createElement('script');sc.type='text/javascript';sc.async=true;
var s=document.getElementsByTagName('script')[0];sc.src='js/webpjs-0.0.2.min.js';s.parentNode.insertBefore(sc,s);}};
WebP.src='data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA';})();</script>
                            </code>
                        </pre>
                    </section>
                    <section>
                        <h3>WebPJS的优缺点</h3>
                        <ul>
                            <li>借助flash让所有浏览器兼容webp</li>
                            <li>只需要一套webp图片</li>
                            <li>需要引入额外的2个文件，共计100+KB...</li>
                            <li>利用flash在客户端进行解码，渲染性能有点渣</li>
                        </ul>
                    </section>
                    <section>
                        <h3>WebPJS并不是银弹</h3>
                        <h4>舍本求末,Google出品不一定是精品</h4>
                    </section>
                </section>

				<section>
					<h2>小结</h2>
				    <ul>
                        <li>webp的优点和应用情况</li>
                        <li>webp的兼容性</li>
                        <li>如何在网页中按需加载webp图片</li>
                        <li>如何让所有浏览器兼容webp - WebPJS</li>
                    </ul>
                </section>
                <section>
                    <h2>结束了</h2>
                    <h2 class="fragment">么？</h2>
                </section>
                <section>
                    <section>
                        <h2>聊聊webp的性能</h3>
                    </section>
                    <section>
                        <h3>编码(Encode)和解码(Decode)速度</h3>
                        <ol style="margin-bottom:30px;">
                            <li>编码速度比JPG慢大约<em class="hl">10倍</em></li>
                            <li>解码速度比JPG慢大约<em class="hl">1.4倍</em></li>
                        </ol>
                        <blockquote style="font-size:80%;" cite="http://www.tuicool.com/articles/FFZ73y">数据参考自:<a href="http://www.tuicool.com/articles/FFZ73y" target="_blank">Faster, smaller and more beautiful web with WebP</a></blockquote>
                    </section>
                    <section>
                        <h3>解码慢1.4倍,对页面渲染影响大否?</h3>
                    </section>
                    <section>
                        <h3>渲染速度测试 - PC端</h3>
                        <video data-autoplay src="img/video.mp4"></video>
                    </section>
                    <section>
                        <h3>渲染速度测试 - PC端</h3>
                        <img src="img/visual-progress.png" alt="progress"/> 
                    </section>
                    <section>
                        <h3>尺寸对比测试</h3>
                        <img src="img/bytes.png" alt="bytes"/>
                    </section>
                    <section>
                        <h3>说明什么问题?</h3>
                        <ul>
                            <li>尽管webp解码速度比JPG慢1.4陪,但实际<em class="hl">渲染速度不慢</em></li>
                        </ul>
                    </section>
                </section>
                <section>
                    <section>
                        <h3>One more thing</h3>
                        <h2>3个小工具</h2>
                    </section>
                    <section>
                        <h3>1. grunt-webp</h3>
                        <p>一个将普通图片转换成webp图片的nodejs包</p>
                        <img src="img/qrcode-grunt-webp.png" alt="grunt-webp"/>
                    </section>
                    <section>
                        <h3>一个命令</h3>
                        <pre>
                        <code data-trim>
grunt webp                        
                        </code>
                        </pre>
                    </section>
                    <section>
                        <h3>蜀黍</h3>
                        <h3>有没有GUI工具啊</h3>
                    </section>
                    <section>
                        <h3>2. 智图(zhitu)</h3>
                        <p>来自<a href="http://isux.tencent.com" target="_blank">腾讯ISUX前端团队</a>的图片优化平台:<a href="http://zhitu.tencent.com" alt="zhitu">zhitu.tencent.com</a></p>
                        <a href="http://zhitu.tencent.com" target="_blank"><img src="img/zhitu.png" alt="zhitu.tencent.com"/></a>
                    </section>
                    <section>
                        <h3>薯薯</h3>
                        <h3>有没有按需加载webp图片滴JS组件啊</h3>
                    </section>
                    <section>
                        <h3>3. LazyPic.JS</h3>
                        <p>一个支持webp图片的延迟加载组件</p>
                        <img src="img/qrcode-lazypic.png" alt="lazypic.js"/>
                    </section>
                    <section>
                        <h3>半行代码</h3>
                        <pre>
                        <code data-trim>
new LazyPic();                        
                        </code>
                        </pre>
                        <p>
                        <iframe src="//ghbtns.com/github-btn.html?user=mamboer&amp;repo=lazypic&amp;type=watch&amp;count=true" allowtransparency="true" frameborder="0" scrolling="0" width="80" height="20"></iframe>
                        </p>
                    </section>
                </section>
				
				<section>
					<h1>THE END</h1>
					<h3>BY LV / Faso.me</h3>
				</section>
                <section>
					<h2>参考资料</h2>
					<blockquote cite="http://webpjs.appspot.com/">
						&ldquo;WebPJS - Google's new image format WebP for not supported browsers (with alpha-channel)&rdquo;
					</blockquote>
					<blockquote cite="https://github.com/sorrycc/webp-support">
						&ldquo;Script to feature detect if browser support WebP.&rdquo;
					</blockquote>

					<blockquote cite="https://www.npmjs.org/package/grunt-webp">
						&ldquo;grunt-webp&rdquo;
					</blockquote>

					<blockquote cite="http://faso.me/lazypic">
						&ldquo;LazyPic.JS&rdquo;
					</blockquote>

					<blockquote cite="http://zhitu.tencent.com">
						&ldquo;智图(zhitu)&rdquo;
					</blockquote>
				    <blockquote cite="http://www.webpagetest.org/video/compare.php?tests=141121_NG_6MW,141121_N5_4ZH">
                        &ldquo;<a href="http://www.webpagetest.org/video/compare.php?tests=141121_NG_6MW,141121_N5_4ZH" target="_blank">渲染速度对比测试(webpagetest.org)</a>&rdquo;
                    </blockquote>

				    <blockquote cite="http://www.webpagetest.org/video/compare.php?tests=141121_3W_JT7,141121_6Q_JSM">
                        &ldquo;<a href="http://www.webpagetest.org/video/compare.php?tests=141121_3W_JT7,141121_6Q_JSM" target="_blank">渲染速度对比测试-手机端(webpagetest.org)</a>&rdquo;
                    </blockquote>
                </section>
			</div>

		</div>

		<script src="../../assets/revealjs/lib/js/head.min.js"></script>
		<script src="../../assets/revealjs/js/reveal.min.js"></script>

		<script>
            var rvRoot = "../../assets/revealjs/";
			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'concave', // default/cube/page/concave/zoom/linear/fade/none

				// Parallax scrolling
				//parallaxBackgroundImage: 'img/reveal-parallax-2.jpg',
				//parallaxBackgroundSize: '2100px 900px',

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: rvRoot+'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: rvRoot+'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: rvRoot+'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: rvRoot+'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: rvRoot+'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: rvRoot+'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>

	</body>
</html>
