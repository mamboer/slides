<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8"/>

		<title>FASO - Can i use webp?</title>

		<meta name="description" content="Webp - The new image format recommended by Google,can i use it?"/>
		<meta name="author" content="FASO.ME"/>

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>

		<link rel="stylesheet" href="../../assets/revealjs/css/reveal.min.css"/>
		<link rel="stylesheet" href="../../assets/revealjs/css/theme/night.css" id="theme"/>
        <link rel="stylesheet" href="../../assets/common/css/table.css"/>
        <style>
            .red{background:rgb(223, 117, 20) !important;color:#fff !important;}
            .green{background:rgb(28, 184, 65) !important;color:#fff !important;}
        </style>
		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="../../assets/revealjs/lib/css/zenburn.css"/>

		<!-- If the query includes 'print-pdf', include the PDF print sheet -->
		<script>
			if( window.location.search.match( /print-pdf/gi ) ) {
				var link = document.createElement( 'link' );
				link.rel = 'stylesheet';
				link.type = 'text/css';
				link.href = '../../assets/revealjs/css/print/pdf.css';
				document.getElementsByTagName( 'head' )[0].appendChild( link );
			}
		</script>

		<!--[if lt IE 9]>
		<script src="../../assets/revealjs/lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>WebP</h1>
                    <h3>Can i use it?</h3>
					<p>
                    <small>Created by <a href="http://faso.me" target="_blank">LV</a> at 10th Sept. 2014</small>
					</p>
				</section>

				<section>
                    <section>
                        <h2>啥?</h2>
                    </section>
                    <section>
                        <h3>一种新的图片格式</h3>
                    </section>
                    <section>
                        <h3>2011年 Google</h3>
                    </section>
                    <section>
                        <h3>无损压缩（同质PNG，尺寸小25%）</h3>
                    </section>
                    <section>
                        <h3>有损压缩（同质JPG，尺寸小25~34%）</h3>
                    </section>
				</section>

				<!-- Example of nested vertical slides -->
				<section>
					<section>
                        <h2>哪?</h2>
					</section>
					<section>
						<h2>Chrome Webstore</h2>
                        <p>
                            全站90%图片应用webp
                        </p>
					</section>
					<section>
						<h2>QZone</h2>
						<p>少量应用</p>
					</section>
					<section>
						<h2>淘宝&amp;天猫</h2>
						<p>大量应用</p>
					</section>
				</section>

				<section>
					<section>
                        <h2>兼容性？</h2>
                    </section>
                    <section>
                        <iframe src="caniuse.html" scrolling="no" seamless="seamless" style="min-height:520px;width:100%;"></iframe>
                    </section>
                    <section>
                        <h3>各主流浏览器实际支持情况</h3>
                        <div class="datagrid">
                            <table>
                                <thead>
                                    <tr>
                                        <th>OS\BROWSER</th>
                                        <th>UC浏览器(9.0+)</th>
                                        <th>QQ浏览器(5.0+)</th>
                                        <th>Chrome浏览器(36.0+)</th>
                                        <th>Android内置浏览器(4.0+)</th>
                                        <th>微信内置webview</th>
                                        <th>QQ内置webview</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>IOS</strong></td>
                                        <td class="red">否</td>
                                        <td class="red">否</td>
                                        <td class="green">是</td>
                                        <td>N/A</td>
                                        <td class="red">否</td>
                                        <td class="red">否</td>
                                    </tr>
                                    <tr class="alt">
                                        <td><strong>Android</strong></td>
                                        <td class="green">是</td>
                                        <td class="green">是</td>
                                        <td class="green">是</td>
                                        <td class="green">是</td>
                                        <td class="red">否</td>
                                        <td class="red">否</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </section>
				</section>

				<section>
                    <section>
                        <h2>那么问题来了？到底用还是不用呢</h2>
                    </section> 
                    <section>
                        <p>
                            <img src="img/50percent.jpg" alt="50%"/>
                        </p>
                        <p>大约50%的用户受益，另外50%的用户需要兼顾处理</p>
                    </section>
				</section>

				<section>
                    <section>
					    <h2>如何兼顾不支持webp的浏览器？</h2>
                    </section>
                    <section>
                        <h3>按需加载，优雅降级</h3>
                        <pre>
                        <code data-trim>
                            <img data-src="1.png" data-webp="1.png.webp" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"/>
                        </code>
                        </pre>
                        <ol>
                            <li>img标签使用1px的透明gif做填充图片</li>
                            <li>利用data-src放普通图片</li>
                            <li>利用data-webp放webp图片</li>
                            <li>利用js判断浏览器是否支持webp，从而选择合适的图片格式</li>
                        </ol>
                    </section>
                    <section>
                        <h3>如何判断浏览器是否支持webp？</h3>
                        <pre>
                            <code data-trim>
(function() {

  if (this.WebP) return;
  this.WebP = {};

  WebP._cb = function(isSupport, _cb) {
    this.isSupport = function(cb) {
      cb(isSupport);
    };
    _cb(isSupport);
    if (window.chrome || window.opera && window.localStorage) {
      window.localStorage.setItem("webpsupport", isSupport);
    }
  };

  WebP.isSupport = function(cb) {
    if (!cb) return;
    if (!window.chrome && !window.opera) return WebP._cb(false, cb);
    if (window.localStorage && window.localStorage.getItem("webpsupport") !== null) {
      var val = window.localStorage.getItem("webpsupport");
      WebP._cb(val === "true", cb);
      return;
    }
    var img = new Image();
    img.src = "data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA";
    img.onload = img.onerror = function() {
      WebP._cb(img.width === 2 && img.height === 2, cb);
    };
  };

  WebP.run = function(cb) {
    this.isSupport(function(isSupport) {
      if (isSupport) cb();
    });
  };

})();
                            </code>
                        </pre>
                    </section>
                    <section>
                        <h3>按需加载的优缺点</h3>
                        <ul>
                            <li>优点：特别适用于内容图较多较大的手机页面，可以让大约50%的用户显著提升图片加载速度，较少流量消耗</li>
                            <li>缺点：需要为按需加载的图片准备一套webp格式的</li>
                        </ul>
                    </section>
				</section>

				<section>
					<section>
                    <h2>银弹？</h2>
                    <aside class="notes">
                        有没有可能让所有的浏览器兼容webp格式呢
                    </aside>
                    </section>
				    <section>
				        <img src="img/webpjs-qrcode.png" alt="qrcode"/>
                    </section>
				</section>

				<section>
				    <section>
                        <h2>
                            WebPJS
                        </h2>
                        <p>借助FLASH兼容不支持webp的浏览器</p>
                    </section>
                    <section>
                        <h3>下载所需文件-webpjs.appspot.com</h3>
                        <ol>
                            <li><a href="http://webpjs.appspot.com/js/webpjs-0.0.2.min.js" target="_blank">webpjs-0.0.2.min.js</a></li>
                            <li><a href="http://webpjs.appspot.com/js/webpjs-0.0.2.swf" target="_blank">webpjs-0.0.2.swf</a></li>
                        </ol>
                    </section>
                    <section>
                        <h3>在页头引入JS</h3>
                        <pre>
                            <code data-trim>
                            <script>(function(){var WebP=new Image();WebP.onload=WebP.onerror=function(){
if(WebP.height!=2){var sc=document.createElement('script');sc.type='text/javascript';sc.async=true;
var s=document.getElementsByTagName('script')[0];sc.src='js/webpjs-0.0.2.min.js';s.parentNode.insertBefore(sc,s);}};
WebP.src='data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA';})();</script>
                            </code>
                        </pre>
                    </section>
                    <section>
                        <h3>WebPJS的优缺点</h3>
                        <ul>
                            <li>借助flash让所有浏览器兼容webp</li>
                            <li>只需要一套webp图片</li>
                            <li>需要引入额外的2个文件，共计100+KB...</li>
                            <li>利用flash在客户端进行解码，渲染性能有点渣</li>
                        </ul>
                    </section>
                    <section>
                        <h3>WebPJS并不是银弹，Google出品也不一定是精品~</h3>
                    </section>
                </section>

				<section>
					<h2>小结</h2>
				    <ul>
                        <li>webp的优点和应用情况</li>
                        <li>webp的兼容性</li>
                        <li>如何在网页中按需加载webp图片</li>
                        <li>如何让所有浏览器兼容webp - WebPJS</li>
                    </ul>
                </section>
                <section>
                    <h2>要结束了么？</h2>
                </section>
                <section>
                    <section>
                        <h2>2个好东西</h2>
                    </section>
                    <section>
                        <h3>grunt-webp</h3>
                        <p>一个将普通图片转换成webp图片的nodejs包</p>
                        <p><a href="https://www.npmjs.org/package/grunt-webp" target="_blank">想了解grunt-webp请猛击这里！</a></p>
                    </section>
                    <section>
                        <h3>LazyPic.JS</h3>
                        <p>一个支持webp图片的延迟加载组件</p>
                        <p><a href="http://faso.me/lazypic" target="_blank">想要了解更多关于LazyPic的信息，请点我~</a></p>
                    </section>
                </section>
				<section>
					<h2>参考资料</h2>
					<blockquote cite="http://webpjs.appspot.com/">
						&ldquo;WebPJS - Google's new image format WebP for not supported browsers (with alpha-channel)&rdquo;
					</blockquote>
					<blockquote cite="https://github.com/sorrycc/webp-support">
						&ldquo;Script to feature detect if browser support WebP.&rdquo;
					</blockquote>
				</section>
				<section>
					<h1>THE END</h1>
					<h3>BY LV / Faso.me</h3>
				</section>

			</div>

		</div>

		<script src="../../assets/revealjs/lib/js/head.min.js"></script>
		<script src="../../assets/revealjs/js/reveal.min.js"></script>

		<script>
            var rvRoot = "../../assets/revealjs/";
			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'concave', // default/cube/page/concave/zoom/linear/fade/none

				// Parallax scrolling
				parallaxBackgroundImage: 'img/reveal-parallax-2.jpg',
				parallaxBackgroundSize: '2100px 900px',

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: rvRoot+'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: rvRoot+'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: rvRoot+'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: rvRoot+'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: rvRoot+'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: rvRoot+'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>

	</body>
</html>
